# Динамическая маршрутизация

**BGP** - протокол маршрутизации о достижимости между автономными системами в глобальной сети. Использует протокол внутридоменной маршрутизации внутри одной системы и междоменной маршрутизации между несколькими системами. 

**Автономная система (AС)** - система IP-сетей и маршрутизаторов, управляемые одним или несколькими операторами, имеющими единую политику обмена данными с Интернет.

*Выбор маршрута* обеспечивается *на основе политик*, принятых внутри автономных систем.
Поддерживает бесклассовую маршрутизацию.

BGP является протоколом прикладного и действует поверх транспортного уровня. Это один из основных протоколов, благодаря которым функционирует интернет. 

**Формат сообщения:**
1. Маркер (16 октетов)
2. Длина (2 октета)
3. Тип (1 октет):
	1. Открытие
	2. Обновление информации
	3. Оповещение
	4. Сохранение соединения

Первое сообщение при начале работы узла типа "Открытие". Если оно было успешно обработано, то поступает в ответ "Сохранение сессии".

Процесс выбора маршрута запускается после обновления информации и используется для передачи локально и другим маршрутизаторам, использующим BGP.

Номера автономные систем выдаются компанией IANA. 
С 2007 года используются 16-битные ASN. 

**Многоинтерфейсная АС** - имеет несколько внешних каналов доступа в Интернет. Остается стабильно работающей даже при выходе из строя оного из операторов. 

**Ограниченная АС** - АС, имеющая единственное подключение к внешней автономной системы. Считается бесполезной, поскольку располагается строго под одним провайдером, потому за ненадобностью использует уникальный идентификатор.

**Транзитная АС** - АС, которая пропускает через себя транзитный трафик подсетей.

---
# Типы передачи данных

В сетях IP существует 4 основных способа передачи данных:

**Unicast** – процесс отправки пакета от одного хоста к другому хосту.

**Multicast** – процесс отправки пакета от одного хоста к некоторой ограниченной группе хостов.

**Broadcast** – процесс отправки пакета от одного хоста ко всем хостам в сети.

**Anycast** — одноадресная рассылка ближайшему узлу.

---
#### Unicast (Индивидуальный)

![](https://learn.trudmore.ru/assets/uploads/unicast.png)

**Unicast** — одноадресная рассылка — один отправитель, один получатель. (_Пример: запрос HTTP-странички у WEB-сервера_). Можно сказать, что на сегодня, наверное, более 90 процентов сетевого трафика в Интернет это unicast.

Тип передачи данных Unicast (индивидуальный) используется для обычной передачи данных от хоста к хосту. Способ Unicast работает в клиент-серверных и пиринговых (peer-to-peer, от равного к равному) сетях.

В **unicast** пакетах в качестве IP адреса назначения используется конкретный IP адрес устройства, для которого этот пакет предназначен. IP адрес конкретного устройства состоит из **адреса сети** и **адреса хоста**. Следовательно есть возможность маршрутизации **unicast** пакетов по всей сети.

В [IP сетях](https://learn.trudmore.ru/seti/osnovy-setej/ip-adres/) **unicast** адрес является адресом конечного устройства (например, компьютера). Адреса хостов назначаются двум конечным устройствам и используются как IP адрес источника и IP адрес получателя.

---
#### Multicast (Групповой)

![](https://learn.trudmore.ru/assets/uploads/multicast.png)

**Multicast** — многоадресная рассылка — один отправитель, много получателей. (_Пример: IPTV_).

Тип передачи **multicast** разрабатывался для сбережения пропускной способности в IP сетях. С типом передачи данных **multicast**, хост источник может отправить всего один пакет, который может достичь тысячи хостов получателей.

Примеры multicast передачи данных:

- видео и аудио рассылка
- обмен информацией о маршрутах, используемый в маршрутизируемых протоколах.
- распространение программного обеспечения
- ленты новостей

Диапазон **224.0.1.0/24** зарезервирован под протоколы, которым необходимо передавать мультикаст по всей сети, то есть проходить через маршрутизаторы.

Диапазон **224.0.0.0/24** зарезервирован под link-local коммуникации. Мультикастовые пакеты с такими адресами назначения **не могут выходить за пределы одного широковещательного сегмента**.

---
#### Broadcast (Широковещательный)

![](https://learn.trudmore.ru/assets/uploads/broadcast.png)

**Broadcast** — широковещательная рассылка — один отправитель, получатели — все устройства в широковещательном сегменте.

Когда хосту нужна информация, он отправляет запрос на широковещательный адрес. Все остальные хосты в сети получат и обработают этот запрос. Один или несколько хостов вложат запрашиваемую информацию и ответят на запрос. В качестве типа передачи данных, отвечающие на запрос будут использовать unicast.

На основе этого механизма работает протокол ARP, который позволяет узнать мак-адреса по известному IP-адресу. Также при помощи broadcast запросов конечные узлы делают запросы DHCP-серверу на получение IP-адреса и других опций.

В отличие от unicast передачи, где пакеты могут быть маршрутизированы через всю сеть, broadcast пакеты, как правило, ограничиваются локальной сетью. Это ограничение зависит от настройки маршрутизатора, который ограничивает сеть и следит за типом широковещания (broadcast).

Существует два типа broadcast передачи данных: **направленное широковещание** и **ограниченное широковещание**.

##### Направленный broadcast (направленное широковещание)

![направленное широковещание](https://learn.trudmore.ru/assets/uploads/napravlennoe-shirokoveshhanie.png)

Направленный broadcast отправляется всем хостам какой-то конкретной сети. Этот тип широковещания удобно использовать для отправки broadcast трафика всем хостам за пределами локальной сети.

Например, хост хочет отправить пакет всем хостам в сети **192.168.0.0/24**, но сам хост находится в другой сети. В данном случае хост-отправитель вложит в заголовок пакета в качестве адреса пункта назначения broadcast адрес **192.168.0.255**. Хотя маршрутизаторы должны ограничивать (не передавать) направленный широковещательный трафик, их можно настроить на разрешение передачи broadcast трафика.

##### Ограниченный broadcast (ограниченное широковещание)

![ограниченное широковещание](https://learn.trudmore.ru/assets/uploads/ogranichennoe-shirokoveshhanie.png)

Ограниченный broadcast используется для передачи данных всем хостам в локальной сети. В такие пакеты в качестве пункта назначения вставляется IP адрес **255.255.255.255**. Маршрутизаторы такой широковещательный трафик не передают. Пакеты, переданные ограниченным broadcast, будут распространяться только в локальной сети. По этой причине локальные сети IP также называют **широковещательным доменом** (broadcast domain). Маршрутизаторы образуют границу для широковещательного домена. Если бы не было ограничений, пакеты распространялись по всей сети, уменьшая быстродействие сетевых устройств тем самым забивая пропускную способность каналов связи.

Например, хост находится внутри сети **192.168.0.0/24** и хочет передать пакет всем хостам в его сети. Используя в качестве пункта назначения IP адрес **255.255.255.255**, он отправляет широковещательный пакет. Этот пакет примут и обработают все хосты только в этой локальной сети (**192.168.0.0/24**).

---
#### Anycast

**Anycast** — одноадресная рассылка ближайшему узлу — один отправитель, вообще получателей много, но фактически данные отправляются только одному. (_Пример: Anycast DNS_).

Multicast часто путают с Anycast, однако основное отличие состоит в том, что Anycast направляет отправителя к одному конкретному узлу, даже если доступны несколько узлов.

Если у сервиса миллионы подписчиков, то он обычно использует множество серверов, каждый из которых **имеет один и тот же IP-адрес**. Эти серверы распределены географически для оптимального обслуживания запросов. Например, DNS Google с IP адресом 8.8.8.8. Сервера с этим адресом расположены в дата центрах по всему миру. В этом случае, Anycast позволяет найти оптимальный путь до ближайшего сервера. Следует заметить, что выбирается не только кратчайший, но и с меньшем временем задержки путь.

---

**Ячеистые сети** - сетевая топология компьютерной сети, построенная на принципе ячеек, в которых рабочие станции соединяются друг с другом и некоторые из них способны брать на себя роль коммутатора.

**NAT (Network Address Translation)** - (преобразование сетевых адресов) механизм в сетях TCP/IP, позволяющий преобразовывать IP-адреса транзитных пакетов. Такое преобразование может использоваться в любом маршрутизирующем устройстве.

Принимая пакет от локального компьютера, роутер смотрит на IP-адрес назначения. Если он внутренний, то пакет просто пересылается этому абоненту. Если же он внешний, то необходима пересылка в Интернет. Но в таком случае адресом возврата будет его локальный адрес, который не доступен из сети Интернет напрямую. В таком случае происходит преобразование и маршрутизатор меняет адрес возврата на свой в глобальной сети, а также подменяет номер порта.

---

**6rd (IPv6 Rapid Deployment)** - переходной механизм, позволяющий интернет-провайдерам предоставлять клиентам IPv6 подключение поверх своей IPv4 сети. 

---

Next door: [[АС ЭВМ - Лекция 7]]
