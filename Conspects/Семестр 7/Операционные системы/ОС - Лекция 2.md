# <font style="color:#ffb640">Работа с виртуальной памятью</font>

Всего существует 3 реализации организации виртуальной памяти:
- Сегментные 
- Страничные
- Странично-сегментные

---
#### <font style="color:#03b1fc">Страничная реализация организации</font>

1. Программа делится на страницы, имеющие одинаковый размер. 
2. Все страницы по размеру кратны степени 2
3. Страницы обычно относительно небольшого размера (в современных Windows и Linux 4 КБайт)

Адрес обращения представляет форму:
> СТРАНИЦА - СМЕЩЕНИЕ (конкатенация)

По номеру страницы и смещению выбираются необходимые сегменты программы. Если необходимый сегмент отсутствует, происходит его загрузка из раздела носителя. В результате остается номер искомого кадра программы. 

На выходе получается исполнительный адрес: номер кадра + номер страницы. 

![[ОС2.1.jpg | 500]]

Недостатки организации: 

- При данном подходе возникает множество моментов, в которых данного рода поиск не будет работать оптимально. В памяти обычно одновременно сохраняется минимум страниц, необходимых для корректного функционирования программы. 

- Бывает сложно реализовать защиту. 

---
#### <font style="color:#03b1fc">Сегментная реализация организации</font>

**Сегмент** - фрагмент программы, который несет в себе логически законченную функцию. 

Память разбивается на сегменты (разные размеры). При поиске происходит обращение по номеру сегмента. При отсутствии необходимого сегмента происходит подгрузка - поиск на носителе. 

Трансляция адресов происходит обращением: 
> АДРЕС СЕГМЕНТА - СМЕЩЕНИЕ (сложение арифметически)

Каждый сегмент представляет законченный блок программы - он может быть больше страницы, но его необходимо размещать в оперативной памяти.

Преимущество: 
- поскольку сегмент представляет законченный участок программы, возможно прописать его права:
	- r / w / x - разрешение на чтение / запись / исполнение

- методы взаимоисключения - позволяют держать в блоке памяти кольцевой буфер

---
#### <font style="color:#03b1fc">Странично-сегментная орагиназция</font>

При страничной организации предполагается, что виртуальная память — это непрерывный массив со сквозной нумерацией слов, что не всегда можно признать оптимальным. Обычно программа состоит из нескольких частей — кодовой, информационной и стековой. Так как заранее неизвестны длины этих составляющих, то удобно, чтобы при программировании каждая из них имела собственную нумерацию слов, отсчитываемых с нуля. Для этого организуют систему _сегментированной памяти,_ выделяя в виртуальном пространстве независимые линейные пространства переменной длины, называемые _сегментами._ Каждый сегмент представляет собой отдельную логическую единицу информации, содержащую совокупность данных или программный код и расположенную в адресном пространстве пользователя. В каждом сегменте устанавливается своя собственная нумерация слов, начиная с нуля. Виртуальная память также разбивается на сегменты, с независимой адресацией слов внутри сегмента. Каждой составляющей программы выделяется сегмент памяти. Виртуальный адрес определяется номером сегмента и адресом внутри сегмента. Для преобразования виртуального адреса в физический используется специальная _сегментная таблица._

Недостатком такого подхода является то, что неодинаковый размер сегментов приводит к неэффективному использованию ОП. Так, если ОП заполнена, то при замещении одного из сегментов требуется вытеснить такой, размер которого равен или больше размера нового. При многократном повторе подобных действии в ОП остается множество свободных участков, недостаточных по размеру для загрузки полного сегмента. Решением проблемы служит _сегментно-страничная организация памяти._ В ней размер сегмента выбирается не произвольно, а задается кратным размеру страницы. Сегмент может содержать то или иное, но обязательно целое число страниц, даже если одна из страниц заполнена частично. Возникает определенная иерархия в организации доступа к данным, состоящая из трех ступеней: сегмент > страница > слово. Этой структуре соответствует иерархия таблица служащих для перевода виртуальных адресов в физические. В сегментной таблице программы перечисляются все сегменты данной программы с указанием начальных адресов СТ, относящихся к каждому сегменту. Количество страничных таблиц равно числу сегментов и любая из них определяет расположение каждой из страниц сегмента в памяти, которые могут располагаться не подряд — часть страниц может находиться в ОП, остальные — во внешней памяти.

Для получения физического адреса необходим доступ к сегментной и одной из страничных таблиц, поэтому преобразование адреса может занимать много времени.

![[img-RyEocc.png]]

---
## Организация защиты памяти

#защитапамяти

Современные вычислительные машины, как правило, работают в многопользовательском и многозадачном режимах, когда в основной памяти одновременно находятся программы, относящиеся как к разным пользователям, так и к различным задачам одного пользователя. Если даже ВМ выполняет только одну программу, в ОП, помимо этой программы и относящихся к ней данных, всегда присутствуют Фрагменты операционной системы. Каждой задаче в основной памяти выделяется свое адресное пространство. Такие пространства, если только это специально не предусмотрено, обычно независимы. В то же время в программах могут содержаться ошибки, приводящие к вторжению в адресное пространство других задач. Следствием этих ошибок может стать искажение информации, принадлежащей другим Программам. Следовательно, в ВМ обязательно должны быть предусмотрены меры, предотвращающие несанкционированное воздействие программ одного пользователя на работу программ других пользователей и на операционную систему. Особенно опасны последствия таких ошибок при нарушении адресного пространства операционной системы.

Чтобы воспрепятствовать разрушению одних программ другими, достаточно защитить область памяти данной программы от попыток записи в него со стороны других программ (защита от записи). В ряде случаев необходимо иметь возможность защиты и от чтения со стороны других программ, например при ограничениях на доступ к системной информации.

Защита от вторжения программ в чужие адресные пространства реализуется различными средствами и способами, но в любом варианте к системе защиты предъявляются два требования: ее реализация не должна заметно снижать производительность ВМ и требовать слишком больших аппаратных затрат.

Задача обычно решается за счет сочетания программных и аппаратных средств, хотя ответственность за охрану адресных пространств от несанкционированного доступа обычно возлагается на операционную систему. В учебнике рассматриваются, главным образом, аппаратные аспекты проблемы защиты памяти.

Предоставляет удобство в случае, когда при работе программ время от времени требуется обеспечить обобществление - разделение памяти (выделение совместно-используемой памяти). 

![[ОСЬ2.2.jpg | 300]] ![[ОСь2.3.jpg | 300]]

При данной организации выстраиваются логические цепочки связей, в которых устанавливается необходимая часть для функционирования. 

---

Next door: [[Семестр 7/Операционные системы/ОС - Лекция 3]]