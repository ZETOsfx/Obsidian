
Связь:
- Размерность (рекурсивная, M-арная, соотношения в бинарных связях)
- Мощность 
	- One-to-one
	- One-to-many
	- Many-to-many
- Модальность 

---
### Нормализация

Нормализация - создание набора отношений на основе некоторых требований.
**Основная задача:** Найти наилучшую группировку атрибутов по отношениям в данной схеме.

**Цель нормализации:** проверка корректности модели для конкретной нормальной формы.

> Конкретная нормальная форма дает защиту от дублирования данных и возникновения аномалий.

Процесс нормализации
Идентификация отношений по:
- Первичному (или потенциальному) ключу 
- Функциональной зависимости

Проверка отдельных отношений на соответствие правилам нужной нормальной формы.

###### Процесс нормализации
1. Проверка каждого отношения на требования нормальной формы.
2. Выполнение действий нормализации, если необходимо.

Каждая последующая нормальная форма накладывает еще большие ограничения.

---
### Нормальные формы

- ННФ - ненормальная форма - без требований
- 1НФ - первая нормальная форма - обязательное требование реляционных БД
- 2НФ, 3НФ, НФБК - устранение часто возникающих аномалий 
- 4НФ - решение проблем с многозначной зависимостью
- 5НФ - решение проблем с зависимостями соединения

**Функциональная зависимость** описывает связь между атрибутами отношения

Если в отношении один атрибут функционально зависит от другого, то каждое значение первого атрибута связано только с одним значением второго.

**Детерминант** - атрибут, от которого полностью функционально зависит некоторый другой атрибут. Атрибут или группа атрибутов в функциональной зависимости, которые являются независимыми в паре.

---
### Функциональная зависимость

Отношение содержит атрибуты *A* и *B*:  
Каждое значение А связано *только с одним* значением атрибута В => **B функционально зависит от А (A→B)**.

При этом атрибуты A и B могут быть составными.

---
### Полная функциональная зависимость

В отношении атрибут В *полностью функционально зависит* от атрибута А, если:
- В функционально зависит от полного значения А (составные атрибуты) 
- В не зависит от подмножества полного значения А

---
### Транзитивная зависимость

Если для атрибутов А, В и С существуют зависимости: *А→В* и *В→С*  
значит *С транзитивно зависит от А через B*.  
* Если А функционально не зависит от В и С.

---
### Многозначная зависимость

Для каждого значения атрибута А  есть наборы значений атрибутов В и С, но входящие в эти наборы значения не зависят от В и С.

**Тривиальная многозначная зависимость** - атрибут В является подмножеством А или A⋃B - все множество отношения.

**Нетривиальная** - не выполняются условия.

---
##### Первая нормальная форма

**Ненормализованная форма** - отношение содержит повторяющиеся группы данных в одной ячейке.
**Первая нормальная форма (1НФ)** - отношение, в котором на пересечении строки и столбца содержится *только одно* значение.

Пример: (дана ненормальная форма)

| Задача              | Исполнитель    |
| ------------------- | -------------- |
| Нормализовать БД    | Иванов, Петров |
| Составить ER-модель | Иванов         |

1. Декомпозировать записи продублировав остальные данные:

| Задача              | Исполнитель | 
| ------------------- | ----------- |
| Нормализовать БД    | Иванов      |
| Нормализовать БД    | Петров      |
| Составить ER-модель | Иванов      |

2. Выделить списки в отдельную сущность:

| ID  | Задача              |
| --- | ------------------- |
| 1   | Нормализовать БД    |
| 2   | Составить ER-модель |

| ID  | Исполнитель |
| --- | ----------- |
| 1   | Иванов      |
| 2   | Петров      |

| ID задача | ID исполнителя |
| --------- | -------------- |
| 1         | 1              |
| 1         | 2              |
| 2         | 1              |

---
##### Вторая нормальная форма

1. Отношение находится в *1НФ*.
2. Каждый атрибут, не входящий в первичный ключ, *полностью функционально* зависит от первичного ключа.

Если у вас первичный ключ только один - id, то отношение уже в *2НФ*.
Составной первичный ключ возникает при декомпозиции в *1НФ* связей многие-ко-многим.

---
##### Третья нормальная форма

1. Находится во *2НФ*.
2. Нет атрибутов, не входящих в первичный ключ, которые находятся в транзитивной зависимости от первичного ключа.

Все атрибуты зависят *только от первичного ключа напрямую*. Теперь и транзитивные зависимости нужно убрать.

---

##### Нормальная форма Бойса-Кодда

1. Находится в 3НФ
2. Каждый детерминант является потенциальным ключом.

Найти все детерминанты и убедиться, что они являются потенциальными ключами, то есть однозначно определяют запись в таблице.

Если есть непотенциальные ключи, то вынести в отдельную сущность.

**НФБК:** Убирать лишние ключи: в таблице должен остаться только один первичный ключ.
Убираем id, так как все зависимости для обоих первичных ключей.

---
##### Четвертая нормальная форма

Отношение из базы магазина, который занимается реселлингом:

| Поставщик | Заказчик | Магазин |
| --------- | -------- | ------- |
|           |          |         |

**Свойства отношения:**
- Атрибут поставщик не зависит от магазина, так как поставщик зависит от заказчика. 
- Заказчик может быть привязан к любому магазину и любому поставщику.
- Первичный ключ - все три атрибута и больше атрибутов нет, поэтому отношение уже в НФБК.

**Проблема обновления:**
Если нужно добавить к одному заказчику нового поставщика, то это нужно сделать для всех магазинов.
Если нужно удалить поставщика, то это тоже нужно сделать из всех магазинов, и это может привести к удалению заказчика (если он работал только с одним поставщиком).

**Прийти к 4НФ:**
Не должно быть нетривиальных многозначных зависимостей.

или

Может быть многозначная зависимость, но она должна быть единственной (то есть быть функциональной) и отношение должно быть в НФБК (то есть должен быть один потенциальный ключ).

После декомпозиции:

| Поставщик | Магазин |
| --------- | ------- |
|           |         |

| Заказчик | Магазин |
| -------- | ------- |
|          |         |

