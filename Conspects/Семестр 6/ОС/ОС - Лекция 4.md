#### Типы мультипрограммной работы

- Независимые процессы
- Синхронные процессы
- Асинхронные процессы

---
##### Разделяемые ресурсы

**Предоставляемые ОС:**
- Сигналы и сообщения (почтовые ящики)  - поддерживаются самой ОС
- Каналы (pipes)
- Разделенная память

**Требующие участия самих процессов:**
- Каналы
- Разделяемая память

---

*Пример (изрядно надуманный)*
- пользователи работают на одном компьютере за множеством терминалов.
- На каждом терминале выполняется своя программа
- На компьютере необходимо подсчитать количество нажатий клавиш Enter всеми пользователями за рабочий день.

*Идея решения*
- Завести переменную Count
- При каждом нажатии на Enter на любом терминале увеличиваем переменную на 1

---
##### Разделяемый ресурс

- Приходим к понятию разделяемого ресурса который в каждый конкретный момент времени должен быть доступен на изменение только одному процессу
- Такой ресурс называется «оперативно не перераспределяемым»
- Соответственно, в системе могут быть разделяемые ресурсы другого типа - «оперативно перераспределяемые»

Название «Винчестер» появилось из-за совпадения номера первой модели с маркировкой винтовки, популярной те годы.

**Понятие взаимоисключения** #взаимоисключение
- ﻿﻿Несколько процессов должны в процессе работы получать доступ к одному и тому же ресурсу.  
    Этот доступ каждому процессу должен предоставляться так, чтобы исключить в этот момент доступ и ресурсу другим процессам.
- ﻿﻿Если ресурс свободен, процесс может получить к не доступ в любой момент.
- ﻿﻿Если ресурс занят другим процессом, то процесс должен ожидать его освобождения.
- ﻿﻿Доступ реализуется с помощью двух примитивов типа  
    «Занять ресурс» и «Освободить ресурс»

**Критический участок**
- ﻿﻿Процесс, получивший доступ к разделяемому ресурсу, входит в свой критический участок.
- ﻿﻿Процесс должен находиться в критическом участке минимальное время.
- Сразу по выходу из критического участка процесс должен освободить ресурс.

Критический участок (критическая секция) — участок исполняемого кода программы, в котором производится доступ к общему ресурсу (данным или устройству), который не должен быть одновременно использован более чем одним потоком выполнения.

**Способы организации взаимоисключения**
- Программный (без привлечения средств операционной системы и аппаратуры компьютера)
- ﻿﻿Семафоры (возможности операционной системы)
- ﻿﻿Мониторы (специальный механизм систем программирования)
- С привлечением аппаратных возможностей компьютера

---
##### Программный

*Условия (требования) реализации:*
- ﻿﻿Чисто программный метод (процессы вне критических участков не должны мешать другим процессам сами, без помощи системы или аппаратных возможностей)
- ﻿﻿Не должно быть никаких предположений о взаимной скорости работы асинхронных процессов.
- ﻿﻿Процессы, находящиеся вне своих критических участков, не должны препятствовать другим процессам входить в их собственные критические участки.
- ﻿﻿Не должно быть бесконечного откладывания момента входа процессов в их критические участки.

**Современная наука рассматривает 2 варианта:**
- взаимоисключение для двух процессов
- взаимоисключение для множества процессов

Подробно рассмотрим только реальные взаимоисключения для двух процессов.

###### 1. Алгоритм Деккера

Данный алгоритм имеет несколько проблем. В некоторых случаях процесс может начать пользоваться критическим участком памяти одновременно со вторым процессом.

###### 2. Алгоритм Петерсона

Во многом схож с алгоритмом Деккера. Даже в случае работы в мультипроцессорной системе будет все ОК (не будет бесконечного откладывания, не задействуется никакая аппаратная особенность определенного процессора, реализация чисто программная).

###### 3. Алгоритм Лемпорта 

([https://ru.wikipedia.org/wiki/Алгоритм_пекарни_Лампорта](https://ru.wikipedia.org/wiki/Алгоритм_пекарни_Лампорта))- признан самой изящной реализацией.

---
##### Семафоры

**Семафоры** (механизм организации, предоставляемый ядром ОС) специальные защищенные переменные, их предоставляет сервис. Доступ к ним осуществляется посредством с непосредственно командами ядру.

*Делятся на:*
- Считающие - ﻿﻿могут принимать любые неотрицательные ﻿﻿значения;
- ﻿﻿бинарные (mutex'ы) - могут принимать только значение 0 или 1;

Управляются из прикладных программ с помощью примитивов:
- P(S)
- V(S)
установить на S начальное значение.

| Примитив P(s) | Примитив V(S)  |
| ------------- | -------------- |
| Если S > 0 <br> то: S=S-1 <br> иначе: <br> ждать на S  | Если 1 или > <br> процессов ждут <br> на S: <br> запустить один <br> иначе: S=S-1|

---
##### Мониторы

- Особый механизм реализации взаимоисключения, встроенный в некоторые языки программирования (например, Java)
- ﻿﻿Не требуют поддержки взаимоисключения от операционных систем.
- ﻿﻿Не требуют поддержки от аппаратных средств ЭВМ.
- ﻿﻿Позволяют писать примитивы взаимоисключения наиболее «естественным» образом

**Особенности**
- ﻿﻿Монитор представляет собой совокупность процедур (примитивов взаимоисключения) и переменных, которые «видны» только этим процедурам  
    Прикладная программа (процесс) имеет доступ только к процедурам.  
    При попытке вызова процедуры процесс входит в монитор.
- ﻿﻿Если несколько процессов пытаются одновременно войти в монитор, то это разрешается только одному процессу.  
    Остальные должны ждать за пределами монитора.
- ﻿﻿Внутри монитора в каждый момент времени может находиться только один процесс.

![[ОС4.1.png | 500]]

###### Монитор на Java

```java
private Object obj = new Object();
/* Здесь доступ к obj могут иметь все потоки \*/
synchronized (obj) {
    /* Здесь доступ к obj только у одного потока \*/
    obj.someimportantMethod();
    /* Здесь доступ к об могут иметь все потоки \*/
}
```

###### Монитор «кольцевой буфер»

*Постановка задачи:*
- имеется два процесса;
- процесс один записывает данные в кольцевой буфер
- процесс два читает данные из кольцевого буфера;
- буфер может оказаться переполненным, тогда процесс один должен ждать, пока в нём освободится
- буфер может оказаться пустым, тогда процесс ова должен ждать, пока в нём появятся данные.

- Изучить решение задачи самостоятельно

![[ОС4.2.jpeg | 500]]

###### Монитор «читатели и писатели»

*Постановка задачи:*
- имеется многоабонентная система типа касс по продаже билетов; информация о билетах хранится в централизованной базе данный перед покупкой билета клиент просматривает наличие билетов и их варианты на заданную дату (это могут делать одновременно несколько абонентов);
- когда клиент выбрал билет, он его покупает. При этом система должна внести изменения в базу данных (в этот момент доступ к базе данных должен иметь только процесс этого клиента)
- записывающий процесс должен получить приоритет перед читающими процессами

Изучить решение задачи самостоятельно.

*Основная идея*
- ﻿﻿В системе команд процессора требуется наличие хотя бы одной команды, которая позволяла бы в атомарном режиме выполнить проверку значения переменной и задание ей нового значения.

- ﻿﻿Примерно так:
```c
if (flag == 0)  
	flag = 1;
```

---

Next door: [[ОС - Лекция 5]]
